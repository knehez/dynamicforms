<!-- Schedule Information Header -->
<div class="card mb-3">
  <div class="card-header bg-primary text-white">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h6 class="mb-0">
          <i class="pi pi-calendar mr-2"></i>{{schedule.description}}
        </h6>
      </div>
      <div class="col-md-6">
        <div class="d-flex justify-content-end">
          <span class="badge badge-light mr-2">
            <i class="pi pi-clock mr-1"></i>Makespan: {{result.makespan}}
          </span>
          <span class="badge badge-light mr-2">
            <i class="pi pi-cog mr-1"></i>Setup: {{result.setupTime}}
          </span>
          <span class="badge badge-light">
            <i class="pi pi-refresh mr-1"></i>Setups: {{result.numberOfSetups}}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Jobs Table -->
<div class="card">
  <div class="card-body p-0">
    <p-table id="jobEditorTable" #dt [columns]="jobCols" [value]="jobs" dataKey="name" 
             selectionMode="single" [(selection)]="selectedJob" [paginator]="true" [rows]="5"
             styleClass="p-datatable-sm p-datatable-striped small">
      
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th *ngFor="let col of columns" class="font-weight-bold">
            {{col.header}}
          </th>
          <th style="width: 40px;" class="text-center">
            <i class="pi pi-bars"></i>
          </th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-rowData let-columns="columns" let-index="rowIndex">
        <tr [pSelectableRow]="rowData" 
            (click)="rowSelect.emit({name: rowData.name, jobs: jobs, makespan: result.makespan}); selectJob(rowData)"
            [pReorderableRow]="index" 
            class="cursor-pointer">
          <td *ngFor="let col of columns">
            <span [ngClass]="{'text-muted': col.field !== 'name'}" 
                  [style.background-color]="col.field === 'name' ? getJobColor(rowData[col.field]) : ''"
                  [style.color]="col.field === 'name' ? 'white' : ''"
                  [style.padding]="col.field === 'name' ? '3px 6px' : ''"
                  [style.border-radius]="col.field === 'name' ? '3px' : ''"
                  [style.display]="col.field === 'name' ? 'inline-block' : ''"
                  class="d-inline-block">
              {{ col.minPipe ? col.minPipe.transform(rowData[col.field] * 1000 * 60 + baseStartTime, col.arg) : 
                 col.datePipe ? col.datePipe.transform(rowData[col.field], col.arg) : rowData[col.field] }}
            </span>
          </td>
          <td class="text-center">
            <i class="pi pi-grip-vertical text-muted cursor-move" pReorderableRowHandle></i>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Actions Footer -->
<div class="mt-3 d-flex justify-content-end">
  <button type="button" class="btn btn-success" (click)="saveSchedule()">
    <i class="pi pi-save mr-2"></i>Save Schedule
  </button>
</div>

<!-- Job Editor Sidebar -->
<div class="job-editor-sidebar" [class.open]="sidebarOpen" *ngIf="selectedSidebarJob">
  <div class="sidebar-overlay" (click)="closeSidebar()"></div>
  
  <div class="sidebar-content">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <span class="job-color-indicator" 
                [style.background-color]="getJobColor(selectedSidebarJob.name)"></span>
          <h5 class="mb-0 text-truncate">{{selectedSidebarJob.name}}</h5>
        </div>
        <button type="button" class="btn btn-sm btn-outline-secondary" (click)="closeSidebar()">
          <i class="pi pi-times"></i>
        </button>
      </div>
    </div>

    <!-- Sidebar Body -->
    <div class="sidebar-body">
      <!-- Operations Section -->
      <div class="mb-4">
        <h6 class="text-primary mb-3">
          <i class="pi pi-wrench mr-2"></i>Operations
        </h6>
        <div class="operation-group mb-3" *ngFor="let ops of selectedSidebarJob.route.operations; let i = index">
          <label class="form-label text-muted small">Step {{i + 1}}</label>
          <div class="btn-group d-flex" role="group">
            <button type="button" 
                    class="btn flex-fill" 
                    [ngClass]="isOperationSelected(selectedSidebarJob, op, i) ? 'btn-primary' : 'btn-outline-secondary'"
                    *ngFor="let op of ops"
                    (click)="selectOperation(selectedSidebarJob, op, i)">
              <span class="font-weight-bold">{{op[0]}}</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Release Time Section -->
      <div class="mb-4">
        <h6 class="text-primary mb-3">
          <i class="pi pi-clock mr-2"></i>Release Time
        </h6>
        <div class="form-group">
          <label class="form-label text-muted small">Current Release Time</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text">
                <i class="pi pi-calendar"></i>
              </span>
            </div>
            <input type="text" 
                   class="form-control" 
                   readonly
                   [value]="(selectedSidebarJob.releaseTime * 1000 * 60 + this.baseStartTime) | date:'yyyy-MM-dd HH:mm'">
            <div class="input-group-append">
              <button type="button" 
                      class="btn btn-primary" 
                      (click)="setReleaseTime(selectedSidebarJob)">
                <i class="pi pi-check mr-1"></i>Set to Now
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>