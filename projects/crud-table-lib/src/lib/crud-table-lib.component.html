<div class="d-flex justify-content-between p-2">
  <div *ngIf="showBack">
    <button class="btn btn-sm btn-outline-success" type="button" aria-label="Search" (click)="backClicked.emit()"><span
        class="pi pi-arrow-left align-middle"></span></button>
  </div>

  <div class="form-inline">
    <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search"
      [(ngModel)]="searchFilter">
  </div>
</div>

<div class="table-responsive">
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <ng-container *ngFor="let col of formElements">
          <th scope="col" *ngIf="!col.hidden">{{col.header}}</th>
        </ng-container>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let dataRow of tableData" [class.highlighted]="selectedRows.includes(dataRow)">
        <ng-container *ngFor="let col of formElements">
          <td scope="row" class="align-middle" *ngIf="!col.hidden" (click)="selectRow(dataRow); rowSelect.emit(dataRow)">
            <div *ngIf="!col.linkedObject">

              <div [ngSwitch]="col.controlType">
                <div *ngSwitchCase="'checkbox'">
                  <i *ngIf="dataRow[col.key]" class="pi pi-check text-success"></i>
                  <i *ngIf="!dataRow[col.key]" class="pi pi-times text-danger"></i>
                </div>

                <div *ngSwitchCase="'file'" class="text-center">
                  <div *ngIf="base64MimeType(dataRow[col.key]) !== null">
                    <img class="w-25" *ngIf="base64MimeType(dataRow[col.key])['type'] === 'image'" [src]="dataRow[col.key]" (click)="openModalImg(dataRow['id'])" libClickStopPropagation>
                    <div *ngIf="base64MimeType(dataRow[col.key])['type'] !== 'image'">
                      <img class="w-25" src="assets/file.png" (click)="openModalImg(dataRow['id'])" libClickStopPropagation>
                    </div>
                  </div>
                </div>

                <div *ngSwitchDefault [ngSwitch]="col.controlType">
                  <!-- textareas will be displayed with small font-->
                  <small *ngSwitchCase="'textarea'" class="crud-table-col-content">{{truncate(dataRow[col.key])}}</small>
                  <!-- all other cell values-->

                  <div *ngSwitchDefault>
                    <ngb-highlight class="crud-table-col-content" *ngIf="col.type != 'password'" [result]="dataRow[col.key]" [term]="searchFilter">
                    </ngb-highlight>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="col.linkedObject && col.multipleSelect">
              <span *ngFor="let val of dataRow[col.linkedObject]" class="badge badge-success m-1"
                (click)="cellSelect.emit({col:col.linkedData, data:val[col.linkedData.value]})" libClickStopPropagation>
                {{val[col.linkedData.value]}}</span>
            </div>
            <div *ngIf="col.linkedObject && !col.multipleSelect">
              <span class="badge badge-success m-1"
                (click)="cellSelect.emit({col:col.linkedData, data: dataRow[singleName(col.linkedObject)][col.linkedData.value]})"
                libClickStopPropagation>
                {{dataRow[singleName(col.linkedObject)][col.linkedData.value]}}</span>
            </div>

          </td>
        </ng-container>
        <td align="right">
          <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-outline-primary mr-1 btn-sm crud-table-row-edit-btn" *ngIf="showEdit"
              (click)="editRow(dataRow)"
              [disabled]="!canUpdateEntity()">
              <span class="pi pi-pencil"></span>
            </button>
            <button type="button" class="btn btn-outline-danger mr-1 btn-sm crud-table-row-delete-btn"
              (click)="confirmThenDelete(dataRow)"
              [disabled]="!canDeleteEntity()">
              <span class="pi pi-trash"></span>
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="d-flex justify-content-between p-2">
  <div class="mr-auto">
    <small>Showing {{firstEntity + 1}} to {{lastEntity}} of {{currentEntities}} </small>
    <small *ngIf="searchFilter">(filtered from {{allEntities}} entries)</small>
  </div>

  <button type="button" id="crud-table-show-all-btn" class="btn btn-outline-primary btn-sm align-self-start m-2" (click)="showAll()">Show
    all</button>

  <button type="button" id="crud-table-add-btn" class="btn btn-outline-primary btn-sm align-self-start m-2" (click)="add()" *ngIf="showAdd"
    [disabled]="!canCreateEntity()">Add</button>

  <ngb-pagination class="m-2 pagination-sm" [collectionSize]="currentEntities" [(page)]="page"
    [pageSize]="itemsPerPage">
  </ngb-pagination>
</div>

<div class="confirmation">
  <p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>
</div>